汎用化戦略

I. アナライザーについて：

以下では、「最初に提示した法令HTML解析コード」をより汎用的に使うために、ユーザーが事前にインプット（設定や入力）すれば良いと思われるポイントを網羅的に列挙します。これらを**ユーザー設定ファイル（例: JSONやYAML、あるいは対話的なCLI入力）**として受け取り、コード実行時に反映させるイメージです。

1. 法令固有の基本情報
	1.	法令名 (name) / 公式タイトル (official_title) / 短縮タイトル (short_title)
	•	例: GDPR, Digital Markets Act など
	•	Supabaseなどにアップロードするときの regulations.name や regulations.official_title に相当
	•	コード内でハードコードせず、ユーザー入力（あるいは抽出結果のJSONに含める）形にすると、他法令との切り替えが容易になります。
	2.	施行日 (effective_date), 公布日 (document_date), バージョン (version), ステータス (status)
	•	これも個々の法令で異なるため、ユーザーが入力するかメタデータとして保持しておく必要があります。
	•	例: "effective_date": "2018-05-25"（GDPRの場合）
	3.	ソースURLやCELEX番号、その他ID
	•	例: GDPRなら "https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=CELEX:32016R0679"
	•	CELEX番号など法令独自の識別子はEUR-Lexに複数バージョンある場合の判定にも有用です。

2. 法令HTMLの構造に関する情報
	4.	前文（Recitals）のHTML構造や検索手段
	•	DMAでは id="rct_*" などを利用していますが、GDPR等では異なる構造の場合があります。
	•	前文のCSSクラスやID、開始要素・終端要素をユーザーが指定できるようにする。
	5.	チャプター(Chapter)・セクション(Section)などの階層的区分のパターン
	•	例: 「GDPRではChapter → Section → Articleの順に階層構造がある」「DMAではChapter → Articleの2段階しかない」など。
	•	HTML上のクラス名や見出しテキスト（CHAPTER X か SECTION X かなど）は法令ごとに変わるため、ユーザー入力で定義。
	•	正規表現やCSSセレクタ、IDパターンなどを指定できるようにすると柔軟。
	6.	条文(Article)の検出方式
	•	例: 「GDPRでは Article [数字] 表示を正規表現で検索」「DMAでは eli-subdivision id="art_*" を使う」
	•	タグ階層やクラス名（oj-ti-art など）が異なる可能性を考慮。ユーザーが設定しておけば、一つの汎用コードで対応しやすい。
	7.	定義条項の特別処理
	•	例: DMAではArticle 2が定義条項だが、GDPRではArticle 4（定義）
	•	一般的に「どのArticleがDefinitionsを含むか」、あるいは「定義を抽出するときはテーブルかリストを探すか」など、法令固有の構造をユーザー入力で指定。
	8.	附属書(Annex)の検索方法と複数Annex対応
	•	例: DMAにはAnnexが1つしかないが、GDPRにはそもそもAnnexが存在しないなど。
	•	「Annex I, II, III…」をどのように検索するか、ユーザーが「附属書があるかどうか」を指定したり、クラス名・ID・パターンを設定できるようにする。

3. 条文番号・段落番号の形式
	9.	Article番号の形式・抽出ルール
	•	例: 英語版は Article 1, Article 2...、他言語版では Artikel 1, Articolo 1 のように異なる。
	•	ユーザーが対象言語や検索文字列を設定することで、多言語版にも対応が可能。
	10.	Chapter, Section の番号表記（ローマ数字 / アラビア数字など）

	•	DMAのChapterはローマ数字、他法令は「Chapter 1, 2」などアラビア数字という例もある。
	•	ローマ数字に限定せず、ユーザーに「使用する番号表記」を選ばせる → コード側で正規表現や変換ロジックを切り替え。

	11.	段落(Paragraph)や小段落(Subparagraph)の番号形式

	•	例: (1), (2), (3)... or 1., 2., 3. or (a), (b), (c) など多様。
	•	「数字→アルファベット順」「ローマ数字順」など、ユーザーが入力したルールに基づき正規表現や抽出パターンを切り替える。

4. テキスト正規化の詳細設定
	12.	不要タグ（脚注やハイパーリンクなど）の扱い

	•	どこまで取り除くか、どのタグを残すかをユーザーが制御。
	•	例: GDPRで脚注が多い場合、「脚注は別項目として抽出する」「脚注は削除する」など。

	13.	空白・改行・特殊文字の正規化ルール

	•	「改行を完全除去」か「段落ごとに1行開ける」か等、法令ごとの整形ルールが変わりうる。
	•	これらを設定ファイルやCLIオプションで指定できるようにする。

	14.	引用先や参照リンクの保持

	•	たとえば「(See Article 4)」をリンクとして残すか、生テキストだけにするかもユーザーオプションにする。

5. アップロードやスキーマに関わる情報
	15.	データベース（Supabase）上のテーブル・カラム名

	•	基本的に固定だとしても、他プロジェクトでテーブル名や構造が違う場合に備え、ユーザーが設定で変えられるようにするアーキテクチャを検討する。

	16.	既存データとの衝突時の方針

	•	「既存データを削除して再登録する」「バージョン別に並行管理する」など、運用方針をユーザーに選ばせる。
	•	現在は「既存のDMAがあれば削除して上書きする」形ですが、GDPRの場合も同じ動きが妥当とは限らない。

	17.	どの条文がどのチャプターに属するかなどの階層マッピング

	•	DMAのように document.md で管理する場合でも、GDPRで同様の手動マッピングが要るのか、あるいは自動抽出できるのか。ユーザー側が「マッピングファイルを使う・使わない」などの選択をできるようにする。

6. 多言語対応 / バージョン管理への選択
	18.	言語（EN/FR/DEなど）をどれにするか

	•	HTMLの言語版が複数ある場合、どの言語を解析するか、ユーザーが選ぶ必要がある。
	•	「英語版のみ対応」ならその旨ユーザーに選択させるのも手。

	19.	改正や複数バージョンをどう扱うか

	•	GDPRの改正版や、DMA改訂版などを同一コードで処理する場合、バージョンタグをユーザーが入力して同じ名前で別バージョンとして登録するか、あるいは上書きするのかを選択できるようにする。

7. ログ出力やエラー処理のポリシー
	20.	ログの詳細度 (debug, info, warning, error)

	•	どの程度の詳細を出すか、ユーザーが選べるようにすると、本番運用でもデバッグしやすい。

	21.	エラー発生時の挙動

	•	全体を中断してロールバックするか、可能な部分だけ続行するか。
	•	これもユーザーが選択できるようにすると汎用性が増す。

まとめ

要するに、汎用化のためには「法令固有の情報や構造上の前提」をコード内にハードコードしないことが肝心です。各法令に合わせてユーザーが設定や入力ファイルで指定した項目をもとに、解析ロジックやアップロードの振る舞いを切り替えるようにすれば、DMAからGDPR、その他EU法令へスムーズに拡張できます。
	•	法令名 / タイトル / 日付 / URL / CELEX番号 / ステータス / バージョン など、法令の基本情報
	•	HTML構造（前文の検索方法、定義条項の位置、チャプター・セクション・条文の検出パターン）
	•	条文番号や段落番号の形式（ローマ数字、アラビア数字、アルファベットなど）
	•	Supabase（もしくはDB）スキーマへのマッピング（上書き or バージョン分岐の選択など）
	•	テキスト正規化や引用リンクの扱い

これらをユーザーに対して対話的・あるいは設定ファイルベースで入力してもらう方式にすれば、ユーザーが他法令に適用する際の学習コストやコード修正負担を軽減できます。

II. アップローダーについて：
